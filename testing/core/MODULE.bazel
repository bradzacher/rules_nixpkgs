module(name = "rules_nixpkgs_core_testing")

bazel_dep(name = "rules_nixpkgs_core")
local_path_override(
    module_name = "rules_nixpkgs_core",
    path = "../../core",
)

nixpkgs_repositories = use_extension(
    #"@rules_nixpkgs_core//:extensions.bzl",
    "@rules_nixpkgs_core//private/extensions:repositories.bzl",
    "repositories",
)
nixpkgs_repositories.file(
    name = "nixpkgs",
    file = "nixpkgs.nix",
    file_deps = ["flake.lock"],
)
use_repo(nixpkgs_repositories, "nixpkgs_repositories")

nixpkgs_packages = use_extension(
    #"@rules_nixpkgs_core//:extensions.bzl",
    "@rules_nixpkgs_core//private/extensions:packages.bzl",
    "packages",
)
nixpkgs_packages.attribute(
    name = "hello",
    path = "hello",
    repository = "nixpkgs",
)
use_repo(nixpkgs_packages, "nixpkgs_packages", "rules_nixpkgs_core_testing_hello")

bazel_dep(name = "bazel_skylib", version = "1.0.3")

bazel_dep(name = "nixpkgs_location_expansion_test_file")
local_path_override(
    module_name = "nixpkgs_location_expansion_test_file",
    path = "tests/location_expansion/test_repo",
)

non_module_deps = use_extension("//:non_module_deps.bzl", "non_module_deps")
use_repo(non_module_deps, "nixpkgs")
use_repo(non_module_deps, "remote_nixpkgs")
use_repo(non_module_deps, "nixpkgs_content")
use_repo(non_module_deps, "hello")
use_repo(non_module_deps, "expr-test")
use_repo(non_module_deps, "attribute-test")
use_repo(non_module_deps, "expr-attribute-test")
use_repo(non_module_deps, "extra-args-test")
use_repo(non_module_deps, "nix-file-test")
use_repo(non_module_deps, "nix-file-deps-test")
use_repo(non_module_deps, "nixpkgs-git-repository-test")
use_repo(non_module_deps, "nixpkgs-local-repository-test")
use_repo(non_module_deps, "relative-imports")
use_repo(non_module_deps, "output-filegroup-test")
use_repo(non_module_deps, "output-filegroup-manual-test")
use_repo(non_module_deps, "nixpkgs_location_expansion_test")
